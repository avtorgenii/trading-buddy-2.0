# Debug and run
docker compose -f docker-compose.prod.yml --env-file .env.prod down    -- Stops and removes containers defined in docker-compose.yml
docker compose --env-file .env.prod up --build  -- Forces rebuild of all images before starting containers
docker compose -f docker-compose.dev.yml --env-file .env.dev up -d --build
docker compose -f docker-compose.prod.yml --env-file .env.prod up -d


# Building
docker build -f trading_buddy_backend/Dockerfile -t avtopetrovich/tb-backend:1.0 .
# Frontend must be built with those --build-args because of VITE
docker build --build-arg VITE_API_BASE_URL="http://tb-backend:8000/api/v1" --build-arg VITE_API_SUFFIX="/api/v1" --build-arg VITE_API_BE_BASE_URL="/api/v1" -t avtopetrovich/tb-frontend:1.0 ./trading_buddy_fe/


# Pushing
docker push avtopetrovich/tb-backend:1.0
docker push avtopetrovich/tb-frontend:1.0

# Pulling
docker pull avtopetrovich/tb-backend:1.0
docker pull avtopetrovich/tb-frontend:1.0

# SCP
ssh root@1.1.1.1
scp -r docker-compose.prod.yml .env.prod backup.env nginx.conf backup-configuration root@1.1.1.1:~
-r means recursive to transfer folders

# Volumes
# Zip up volume
docker run --rm -v trading-buddy_postgres_data:/data -v $(pwd):/backup alpine tar czf /backup/postgres_data.tar.gz -C /data .
# Transfer to main machine
scp volume-backup.tar.gz user@main-machine:/path/to/destination/

# Import - worked only for media data, postgres data was imported manually via docker desktop GUI
docker run --rm -v trading-buddy_media_data:/data -v $(pwd):/backup alpine tar xzf /backup/media_data.tar.gz -C /data



# Notion
docker exec -it tb-backend /bin/bash
apt install nano
nano trading_buddy/services/utils/notion_to_database.py
python manage.py shell_plus
import trading_buddy.services.utils.notion_to_database

docker compose -f docker-compose.prod.yml --env-file .env.prod exec db psql -U avtorpetrovich -d postgres -c "TRUNCATE TABLE trading_buddy_tool RESTART IDENTITY CASCADE;"


# Manually fix a trade
docker exec -it tb-backend /bin/bash
uv run python manage.py shell_plus
from datetime import datetime
from decimal import Decimal

pos = Position.objects.first()
pos.tool.name
pos.delete()
trade = Trade.objects.last()

